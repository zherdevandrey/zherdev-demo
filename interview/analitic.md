# KAFKA
1) Что такое топик
Канал публикации сообщений, состоит из партиций.

2) Что такое партиция
Упорядоченная, неизменяемая последовательность сообщений, которые идентифицируются смещением. 
Партиции позволяют распределять данные по нескольким серверам и обрабатывать их параллельно.

3) Что такое consumer group - Группа читателей сообщений. Каждый читает свою партицию

4) Как consumer понимает какой офсет читать? - Kafka хранит offset для каждой consumer group в специальном топике _consumeroffsets.

5) Как обеспечить порядок доставки сообщений - Использовать ключ

6) Гарантии доставки сообщений
- at least once - acks=all, retries, enable.idempotence=true, outbox pattern
- at most once - Уменьшить вероятность повтора продьюсера, inbox pattern
- exactly once - at least once + at most once

# Криптография
1) Как браузер понимает может ли он установить tls соединение
   Браузер проверяет сертификат по нескольким критериям:
   Срок действия - не истек ли сертификат
   Доменное имя - соответствует ли имя в сертификата запрошенному сайту
   Цепочка доверия - подписан ли сертификат доверенным УЦ
   Отзыв сертификата - проверка по CRL или через OCSP

2) Установка tls соединения
- Шаг 1:ClientHello - версии TLS, Случайное число (Client Random, Cipher Suites, Список поддерживаемых методов сжатия, SNI(имя запрашиваемого хоста)
- Шаг 2:ServerHello - выбранная версия TLS, Случайное число (Server Random), Выбранный Cipher Suite, Session ID (идентификатор сессии), Server Certificate
- Шаг 3:
   Клиент генерирует еще одно случайное число, называемое Pre-Master Secret.
   Клиент шифрует Pre-Master Secret с помощью открытого ключа сервера (извлеченного из сертификата) и отправляет его серверу.
   Только сервер может расшифровать это сообщение своим закрытым ключом.
   
   И клиент, и сервер независимо друг от друга вычисляют Master Secret на основе:
   Client Random, Server Random, Pre-Master Secret
   
   Из Master Secret они генерируют одинаковые наборы сеансовых ключей:
   Ключ для симметричного шифрования (например, AES).
   Ключ для проверки целостности сообщений (HMAC).

3) Что такое самоподписной сертификат - подписанный своим же приватным ключем.

4) Что такое mtls
   mTLS — это расширение протокола TLS, которое обеспечивает взаимную аутентификацию обеих сторон соединения.
   Проще говоря:
   Обычный TLS: Клиент проверяет, что он говорит с настоящим сервером (например, с настоящим bank.com).
   mTLS: Сервер также проверяет, что подключившийся клиент является доверенным и известным ему.

# Методологии разработки
1) Чем срам отличается от канбан
Критерий	   SCRUM	                     KANBAN
Итерации	   Фиксированные спринты	     Непрерывный поток
Роли	       Строго определены	         Гибкие, могут отсутствовать
Изменения	   Только между спринтами	     В любой момент
Метрики	       Velocity, story points	     Cycle time, throughput
Визуализация   Scrum/Kanban доска	         Kanban доска
WIP limits	   Рекомендуется	             Обязательно
Подход	       "Перезагрузка" после спринта	 Постоянное улучшение

- Выбирайте SCRUM если:
У вас проект с относительно предсказуемой работой
Команде нужна дисциплина и структура
Хотите predictable delivery

- Выбирайте KANBAN если:
Работа непредсказуема (поддержка, инциденты)
Нужна максимальная гибкость
Хотите оптимизировать поток и уменьшить время обработки

# Системный дизайн
1) Партиционирование, репликация
2) Патерны микросервисной архитектуры 
- Паттерны взаимодействия между сервисами
  API Gateway (API-шлюз), Service Discovery, Circuit Breaker,
- Паттерны развертывания и организации
  API Gateway

  
# Реляционные базы данных
1) Ускорить запрос одним индексом
   SELECT
   u.username,
   o.total_amount
   FROM users u
   JOIN orders o ON u.user_id = o.user_id  -- Вот здесь будет полное сканирование!
   WHERE o.order_date >= '2024-01-01'
   AND u.registration_date >= '2023-01-01';

Для join индекс на users.user_id, order.user_id
Индекс на order.order_date и users.registration_date
Или составные индексы (users.user_id, users.registration_date), (order.user_id, order.order_date)

2) Когда для индексов применить хэш мапу, когда дерево
- Хэш-индекс — для точечного поиска по точному совпадению (WHERE key = value), когда не нужны диапазоны и сортировка.
- Дерево (B-дерево) — универсальный выбор, особенно когда нужен поиск по диапазону, сортировка или доступ к данным в упорядоченном виде.

# Задача
В базе данных есть две таблицы:

customers
| id | name | city |
|-----|--------------|-----------|
| 1 | Иванов Иван | Москва |
| 2 | Петров Петр | Санкт-Петербург |
| 3 | Сидоров Сидор| Москва |


orders
| id | customer_id | order_date | total_amount |
|-----|--------------|------------|--------------|
| 1 | 1 | 2024-07-01 | 1500 |
| 2 | 2 | 2024-07-02 | 2000 |
| 3 | 1 | 2024-07-10 | 500 |
| 4 | 3 | 2024-07-05 | 3000 |

Задача:
Напишите SQL-запрос, который выводит для каждого клиента (его имя, город) и сумму всех его заказов. Результат должен содержать только тех клиентов, у которых есть заказы, и отсортирован по сумме заказов по убыванию.

SELECT
c.name,
c.city,
SUM(o.total_amount) AS total_orders_amount
FROM
customers c
JOIN
orders o ON c.id = o.customer_id
GROUP BY
c.id, c.name, c.city
ORDER BY
total_orders_amount DESC;